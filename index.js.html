<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-use-captured-state.CapturedProvider.html">CapturedProvider</a></li><li><a href="module-use-captured-state.ImmediateCapturedProvider.html">ImmediateCapturedProvider</a></li></ul><h3>Modules</h3><ul><li><a href="module-use-captured-state.html">use-captured-state</a><ul class='methods'><li data-type='method'><a href="module-use-captured-state.html#.useCaptureContextValue">useCaptureContextValue</a></li><li data-type='method'><a href="module-use-captured-state.html#.useCapturedProviderValue">useCapturedProviderValue</a></li><li data-type='method'><a href="module-use-captured-state.html#.useCapturedState">useCapturedState</a></li><li data-type='method'><a href="module-use-captured-state.html#.useCapturedValues">useCapturedValues</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#batchRemoveKeys">batchRemoveKeys</a></li><li><a href="global.html#batchUpdateKeys">batchUpdateKeys</a></li><li><a href="global.html#CaptureContextValue">CaptureContextValue</a></li><li><a href="global.html#forceRerender">forceRerender</a></li><li><a href="global.html#getValues">getValues</a></li><li><a href="global.html#removeKey">removeKey</a></li><li><a href="global.html#updateKey">updateKey</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Index file for the use-captured-state package &lt;br>
 * Contains everything ever needed to be imported from the package
 * @module use-captured-state
 */

import { createContext, useContext, useEffect, useRef, useState } from "react";

/**
 * Updates the value of a single key in the captured values object. &lt;br>
 * Part of the return value of [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef {function} updateKey
 * @param {string} key - Name passed into useCapturedState()
 * @param value - Value to update to at the given key
 */

/**
 * Updates multiple values in the captured values object at once. &lt;br>
 * Part of the return value of [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef {function} batchUpdateKeys
 * @param {Object} batchValues - Object to merge into the captured values object (name: value pairs)
 */

/**
 * Removes a single key and its value from the captured values object. &lt;br>
 * Part of the return value of [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef {function} removeKey
 * @param {string} key - Key to remove from the captured values object
 */

/**
 * Removes multiple keys and their values from the captured values object at once. &lt;br>
 * Part of the return value of [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef {function} batchRemoveKeys
 * @param {string[]} keyList - Array of keys to remove from the captured values object
 */

/**
 * Gets all the captured values from the context. &lt;br>
 * Part of the return value of [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef {function} getValues
 * @return {Object} Object containing all the values using the name argument from useCapturedState calls as keys
 */

/**
 * Forces entire context to rerender if needed. Recommended to be used on an input's onBlur&lt;br>
 * Part of the return value of [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef {function} forceRerender
 * @param {boolean} [smart = true] - Will unconditionally rerender if set to false. Otherwise, only rerenders if a change has been made
 */

/**
 * Contains the captured value object and all the methods to modify it. &lt;br>
 * Is the return value of the [useCapturedProviderValue() hook]{@link module:use-captured-state.useCapturedProviderValue}
 * @global
 * @typedef CaptureContextValue
 * @property {updateKey} updateKey - Function used to update a single key's value in the captured value object
 * @property {batchUpdateKeys} batchUpdateKeys - Function used to update a multiple keys' value in the captured value object
 * @property {removeKey} removeKey - Function used to remove a single keys and its value from the captured value object
 * @property {batchRemoveKeys} batchRemoveKeys - Function used to remove multiple keys and their values from the captured value object
 * @property {getValues} getValues - Returns an object with all the captured values stored in the context. Should only be modified using the other methods in this object. &lt;br>
 *                             _Note: This will initially be an empty object and is only filled with default values on the second render!_
 * @property {forceRerender} forceRerender - Forces the entire context to rerender if a change has occurred. Optional parameter for unconditional rerenders.
 */

/** @type {CaptureContextValue} */
const captureDefaultValue = {
	updateKey: () => {},
	batchUpdateKeys: () => {},
	removeKey: () => {},
	batchRemoveKeys: () => {},
	getValues: () => {},
	forceRerender: () => {}
};

const CaptureContext = createContext(captureDefaultValue);

/**
 * Use this hook if using ImmediateCapturedProvider instead of CapturedProvider and pass the value as the value of ImmediateCapturedProvider
 * Allows the functional component that renders the ImmediateCapturedProvider to have access to the captured value object
 * @returns {CaptureContextValue} Object to pass to ImmediateCapturedProvider.value. Contains a value property with the captured value object
 */
export function useCapturedProviderValue() {
	// State used to force a rerender of the parent component by toggling back and forth. There's probably a better way
	const [render, setRender] = useState(false);

	// Directly modify the ref and change staleState's ref whenever a change has been made to prevent unnecessary re-renders
	const values = useRef({});
	const staleState = useRef(false);

	// Helper functions
	const makeStale = () => staleState.current = true;

	/** @type getValues */
	const getValues = () => values.current;

	/** @type forceRerender */
	const forceRerender = (smart = true) => {
		if(smart &amp;&amp; !staleState.current) return;
		setRender(!render);
	};

	/** @type updateKey */
	const updateKey = (key, value) => {
		makeStale();
		values.current[key] = value;
	};

	/** @type batchUpdateKeys */
	const batchUpdateKeys = batchValues => {
		makeStale();
		for(const key in batchValues) {
			if(!batchValues.hasOwnProperty(key)) continue;
			const value = batchValues[key];
			updateKey(key, value);
		}
		return getValues();
	};

	/** @type removeKey */
	const removeKey = key => {
		if(!(key in values.current)) return;
		makeStale();
		delete values.current[key];
	};

	/** @type batchRemoveKeys */
	const batchRemoveKeys = keyList => {
		keyList.forEach(key => removeKey(key));
		return getValues();
	};

	/** @type {CaptureContextValue} */
	return {
		updateKey: updateKey,
		batchUpdateKeys: batchUpdateKeys,
		removeKey: removeKey,
		batchRemoveKeys: batchRemoveKeys,
		getValues: getValues,
		forceRerender: forceRerender
	};
}

/**
 * Container for all the elements that will use useCapturedState(). Will hold all the captured values from useCapturedState()
 * @param {CaptureContextValue} value - Context value. Obtain it with a call to [useCapturedProviderValue()]{@link module:use-captured-state.useCapturedProviderValue}.
 * @param {JSX.Element|string} children - Elements to render inside provider. These elements will have access to the captured values object through useCapturedState()
 * @returns {JSX.Element} Returns the provider that will contain a section a the page that uses useCapturedState()
 * @constructor
 */
export function ImmediateCapturedProvider({ value, children }) {
	return (
		&lt;CaptureContext.Provider value={value}>
			{children}
		&lt;/CaptureContext.Provider>
	);
}

/**
 * Container for all the elements that will use useCapturedState(). Will hold all the captured values from useCapturedState(). &lt;br>
 * Only difference between this and ImmediateCapturedProvider is that CapturedProvider does not allow the functional component rendering it to access the captured values object. &lt;br>
 * Equivalent to an instance of `&lt;ImmediateCapturedProvider value={useCapturedProviderValue()}>` (Open the source code. That's pretty much all this function is)
 * @param {JSX.Element|string} children - Elements to render inside provider. These elements will have access to the captured values object through useCapturedState()
 * @returns {JSX.Element} Returns the provider that will contain a section a the page that uses useCapturedState()
 * @constructor
 */
export function CapturedProvider({ children }) {
	const capturedProviderValue = useCapturedProviderValue();

	return (
		&lt;ImmediateCapturedProvider value={capturedProviderValue}>
			{children}
		&lt;/ImmediateCapturedProvider>
	);
}

/**
 * Returns the captured values object from the nearest provider. Does not automatically rerender unless forceRerender() is called
 * @returns {Object} Captured values object (Read-only)
 */
export function useCapturedValues() {
	return useCaptureContextValue().getValues();
}

/**
 * Returns the entire CaptureContextValue object with read and write permission to the captured values object
 * @returns {CaptureContextValue} Use to read and modify the containing captured values context
 */
export function useCaptureContextValue() {
	return useContext(CaptureContext);
}

/**
 * A hook similar to useState that allows a component to edit a specific key in the captured value object and allow access to it by anything above it
 * @param {string} name - Name of the captured state. Used as a key in the captured values object
 * @param {string|*} [defaultValue=""] Default value to set as the state. Similar to first argument of useState()
 * @returns {Array.&lt;(string|*),(function(*): void)>} Return value is similar to useState(). An array with [value, setValue] as its entries
 */
export function useCapturedState(name, defaultValue = "") {
	const [capturedState, setCapturedState] = useState(defaultValue);
	const capturedProviderValue = useCaptureContextValue();

	useEffect(() => {
		capturedProviderValue.updateKey(name, capturedState);
	}, [capturedState]);

	return [capturedState, setCapturedState];
}

// Duplicate export as default for backwards compatibility (Deprecated - Import by name instead)
export default useCapturedState;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> on Mon Jun 20 2022 21:59:29 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
